# AI Economist Budgeting Service

Сервис предоставляет REST API для загрузки бюджетов по товарным категориям и
анализа таблиц закупок относительно доступных лимитов. Он заменяет прежнюю
симуляцию микроэкономики на утилиту, которая помогает экономисту быстро
соотнести покупки с бюджетными категориями и понять, достаточно ли средств по
каждой группе.

## Возможности

- Загрузка бюджета в виде набора строк с названием категории, лимитом и
  ключевыми словами, которые помогают автоматически сопоставлять покупки.
- Получение текущего состояния бюджета и суммарного лимита.
- Анализ таблицы закупок: сервис распределяет позиции по категориям (используя
  подсказку `category_hint` или совпадение по ключевым словам), рассчитывает
  потребность и остаток и возвращает отчёт о достаточности средств.

## Структура проекта

- **`service/api`** — приложение FastAPI с эндпоинтами `/budget` и
  `/purchases/analyze`.
- **`service/budget.py`** — in-memory менеджер бюджета с логикой сопоставления
  покупок и расчёта итоговых сумм по категориям.
- **`tests/`** — модульные тесты для API и бизнес-логики.
- **`scripts/`** — вспомогательные скрипты для локального запуска.

## Быстрый старт

```bash
docker compose up --build
```

После сборки сервис доступен по адресу `http://localhost:8081`. FastAPI
документация будет доступна на `http://localhost:8081/docs`.

## Работа с API

### Загрузка бюджета

```bash
curl -X POST http://localhost:8081/budget \
  -H "Content-Type: application/json" \
  -d '{
    "rows": [
      {"category": "Электроника", "limit": 2000000, "keywords": ["ноутбук", "монитор"]},
      {"category": "Крупная бытовая техника", "limit": 5215000, "keywords": ["холодильник"]},
      {"category": "Оргтехника", "limit": 600000, "keywords": ["принтер", "сканер"]}
    ]
  }'
```

Ответ содержит список категорий с лимитами и суммарный бюджет. Текущий бюджет
можно получить повторным GET-запросом на `/budget`.

### Анализ таблицы закупок

```bash
curl -X POST http://localhost:8081/purchases/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "purchases": [
      {"description": "Ноутбук Dell", "amount": 1200000, "category_hint": null},
      {"description": "Холодильник офисный", "amount": 500300, "category_hint": "Крупная бытовая техника"},
      {"description": "МФУ для отдела", "amount": 750000, "category_hint": null}
    ]
  }'
```

В ответе сервис перечислит распознанные категории, укажет, где средств хватает
или не хватает, и вернёт распределение позиций по категориям вместе с остатками.
Нераспознанные покупки выводятся отдельно, чтобы их можно было обработать
вручную.

## Тестирование

```bash
pytest
```

## Лицензия

Проект распространяется по лицензии MIT.
